# Travel Budget Recommendations — MVP Spec

**Document purpose:** Give Replit Agent everything needed to scaffold a working MVP that recommends *destinations within a user’s hard budget cap*, using ballpark estimates for flights, hotels, and daily costs. This focuses on **global search with region/country filters**, transparent ranges (not bookable quotes), and fast testing **without auth**.

---

## 1) Product Overview

**Problem:** Many casual travelers assume travel is too expensive and never check.  
**Solution:** A discovery tool that, given a **total budget** (flights + lodging + daily spend), surfaces **5–10 viable cities** (grouped by country) that typically fit that cap for a specified **trip length** and **timeframe**. It uses **cached averages** and **confidence bands** rather than live quotes.

**Core promise:** “Here’s where you can probably go for your budget — and what the costs roughly look like.”

---

## 2) Primary User Story

> As a traveler with a hard cap (e.g., **$2,000**), I want to enter my **budget**, **origin**, **trip length**, and **region or country preference**, and see **5–10 recommended cities** with a cost breakdown and confidence level so I can decide where to research/book next.

**Inputs**
- **budget** (USD hard cap, required)
- **origin** (IATA or metro, optional for MVP, but recommended for flight realism — e.g., PHX)
- **nights** (3–30; default 10)
- **month** (1–12; optional; used for seasonality bucketing)
- **region** (e.g., asia, europe; optional)
- **country** (e.g., thailand; optional)

**Outputs (for 5–10 cities)**
- City & country, region
- Total estimate (p50) and range (p25–p75)
- Breakdown: flight (avg), hotel/night (p25/p50/p75), daily spend/day (food+transport+misc)
- Confidence label (High/Medium/Low), last updated, sample size (if available)
- “Why this estimate?” disclosure (sources & cadence)

---

## 3) Non‑Goals (MVP)
- No live booking or exact quotes.
- No scraping Airbnb; use OTAs with partner APIs or hotel medians as **proxy** for lodging.
- No complex auth; this is a public demo tool.

---

## 4) Data Vendors & Strategy

**Minimum vendors (lean path):**
- **Flights:** Amadeus (affordable fares / analytics) *or* Skyscanner/Duffel equivalents.  
- **Hotels:** Amadeus Hotels *or* Booking/Expedia partner programs. (Use **percentiles**: p25/p50/p75 per city/month.)  
- **Daily costs:** **Numbeo** Cost of Living API (food, transport, misc).

**Why this is enough:** You combine **avg flight** + (**hotel/night × nights**) + (**daily × nights**). Present **ranges** and **confidence** instead of over‑promising precision.

---

## 5) Refresh Cadence (cache-first)

- **Flights:** weekly for top routes; biweekly for long tail. Store by **origin→city→month**.
- **Hotels:** monthly by **city→month**, save p25/p50/p75 (or low/shoulder/high season buckets).
- **Daily costs (Numbeo):** quarterly (slow-moving).

**Confidence & transparency**
- Compute a simple **confidence score** from sample size + data age (High/Med/Low).  
- Display a small “~± variance” badge (e.g., **flights ±20%**, **hotels ±15–25%**).

---

## 6) Fallbacks & Coverage

- If a target **city** is missing data → fall back to **nearest covered city** or **country median**; mark **Low** confidence.  
- Normalize multi‑airport metros (e.g., **NYC = JFK/EWR/LGA (best-of)**).  
- Cap results to **5–10** cities even if dataset is large.

---

## 7) API Surface (MVP)

### `GET /api/travel/recs`
Returns **ranked recommendations** for cities under (or near) budget.

**Query params:**
- `budget` (number, required) — USD hard cap
- `origin` (string, optional) — IATA/metro; improves flight realism
- `nights` (int, default 10) — range 3–30
- `month` (1–12, optional) — for seasonality buckets
- `region` (string, optional) — e.g., `asia`
- `country` (string, optional) — e.g., `thailand`
- `limit` (int, default 10, max 15)

**Response shape (example):**
```json
{
  "query": {
    "budget": 2000,
    "origin": "PHX",
    "nights": 10,
    "region": "asia",
    "month": 11
  },
  "results": [
    {
      "cityId": "BKK",
      "city": "Bangkok",
      "country": "Thailand",
      "region": "asia",
      "nights": 10,
      "totals": { "p25": 1650, "p50": 1850, "p75": 2150 },
      "breakdown": {
        "flight": 900,
        "hotelPerNightP25": 40,
        "hotelPerNightP50": 55,
        "hotelPerNightP75": 85,
        "dailyPerDay": 40
      },
      "rangeNote": "Hotels vary by season ±15–25%; flights ±20%",
      "confidence": "medium",
      "lastUpdatedISO": "2025-08-01T00:00:00.000Z"
    }
  ],
  "countries": [
    {
      "country": "Thailand",
      "summaryP50": 1820,
      "cities": ["Bangkok", "Chiang Mai", "Phuket"]
    }
  ],
  "meta": {
    "source": ["Amadeus", "Numbeo"],
    "disclaimer": "Ballpark estimates, not live quotes. Events/holidays may raise prices."
  }
}
```

**Ranking:** sort by `totals.p50` ascending; exclude cities where `totals.p75` exceeds `budget × 1.15` unless explicitly allowing “stretch picks”.

---

## 8) Estimation Model (transparent)

```
est_total = flight_avg(origin, city, month)
         + nights * hotel_pX(city, month)
         + nights * (daily_food + daily_transport + daily_misc)
```

- Use **p50** for primary display, **p25–p75** for range.
- Add simple flight variance note (±20%).  
- If month is not provided, use **season bucket** or **annual median**.

---

## 9) Data Model (storage outline)

Use Postgres (or your existing DB) and a Redis hot cache.

- **cities**: `id, name, country_code, region, iata_city, lat, lon, enabled`
- **flight_avg**: `origin_iata, city_iata, month, avg_rt_usd, sample, updated_at`
- **hotel_stats**: `city_id, month, p25_usd, p50_usd, p75_usd, sample, updated_at`
- **daily_cost**: `city_id, daily_food_usd, daily_transport_usd, daily_misc_usd, updated_at`
- *(optional)* **precomp_city_totals**: fast lookup of `p25/p50/p75` totals for common `nights` & `month`.

**Cache keys (Redis):**
- `flight:{origin}:{city}:{month}`
- `hotel:{city}:{month}`
- `daily:{city}`

---

## 10) Mock Mode (for instant testing)

- Provide a **mock dataset** of ~50–80 Asia/Europe cities with plausible numbers (flights, hotel p25/p50/p75, daily costs).  
- Gate real vendor calls behind an env flag (`USE_MOCK=1`).  
- The endpoint should return meaningful results with mock data on day one.

---

## 11) UI Spec (MVP)

**Page: “Where can I go for $X?”**
- Form controls: **Budget (USD)**, **Origin (IATA/Metro)**, **Nights**, **Month**, **Region** (select), **Country** (searchable select).  
- Submit → Show **Top 5–10 results**.

**Results grid:**
- Group by **Country** (country card), list **3–4 cities**.  
- For each city: **p50 total**, **range (p25–p75)**, **confidence**, **last updated**.  
- “How we estimate” tooltip: sources, cadence, variance bands.

**City detail drawer:**
- Hotel percentile toggle (25 / 50 / 75).  
- Breakdown table (flight, hotel/night, daily/day).  
- “Stretch pick” badge if above cap but within +15%.

---

## 12) Guardrails & Legal

- **No scraping Airbnb**; rely on partner APIs or hotels as proxy.  
- Respect vendor **rate limits** & ToS; batch refresh via cron/queue.  
- Surface **disclaimers** clearly: “Ballpark estimates, not live quotes.”  
- Accessibility: keyboard navigation, color contrast, aria labels.

---

## 13) Pitfalls to Solve Now

1) **Over‑promising accuracy** → always show **ranges** and **confidence**.  
2) **Missing data** → use **fallbacks** and display **Low** confidence instead of empty.  
3) **Seasonality** → month buckets; add “Seasonal note” badge for peak months.  
4) **Performance** → precompute top cities; cap results.  
5) **Explainability** → include a `breakdown` object per city in the response and a disclosure in UI.

---

## 14) Minimal Env & Settings

- `USE_MOCK=true|false`
- Vendor keys (when ready): `AMADEUS_API_KEY`, etc.  
- Default origins to precompute (comma‑sep, e.g., `PHX,LAX,JFK,ORD,DFW`).  
- Refresh schedules (cron): flights weekly; hotels monthly; daily costs quarterly.

---

## 15) Test Plan (pre‑auth)

**Happy path:** `$2000 • PHX • 10 nights • Asia • month=11` → 5–10 cities with Medium confidence.  
**Filters:** Adding `country=thailand` narrows to Bangkok/Chiang Mai/Phuket.  
**Edge:** `$900 • 14 nights • Asia` → return none or “stretch picks” (clearly labeled).  
**Explainability:** Click a city → shows breakdown & “How we estimate.”  
**Performance:** Response < 500–800 ms from cache/mock.

---

## 16) Acceptance Criteria

- `GET /api/travel/recs` returns 5–10 plausible cities with **p50 total**, **p25–p75 range**, **confidence**, **breakdown**, and **grouped countries**.  
- UI renders an accessible grid with filters and tooltips.  
- Mock mode works without vendor keys; flipping the env uses real providers later.  
- Disclaimers and methods are visible and consistent.

---

## 17) vNext (after MVP)

- Travel style toggle (hostel / mid‑range / upscale) → changes hotel percentile + daily multiplier.  
- Weather/season flags (avoid monsoon/typhoon months).  
- Save/share: shortlists, sharable links.  
- Multi‑origin support; currency selection; localization.  
- Advanced ranking that blends affordability with interests (beach/culture/nightlife).

---

**End of MVP spec.**  
This document is intentionally **code‑free** so Replit Agent can scaffold files and stubs as needed.
